<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Tr·∫Øc nghi·ªám</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <p id="timer">‚è± Th·ªùi gian: 0s</p>
    <p id="score">ƒê√∫ng: 0 / 0</p>

    <div class="quiz-container">
      <h2 id="q-number"></h2>
      <p id="question"></p>

      <form id="options"></form>

      <p id="answer" class="answer hidden"></p>
    </div>
    <div class="controls">
      <button onclick="goHome()">üè† Trang ch·ªß</button>
      <button onclick="prevQuestion()">‚¨Ö Quay l·∫°i</button>
      <button onclick="checkAnswer()">‚úî X√°c nh·∫≠n</button>
      <button onclick="nextQuestion()">‚û° Ti·∫øp</button>
    </div>
    <script src="Questions.js"></script>
    <script>
      let index = 0;
      const questions = quizData.all;

      let answered = Array(questions.length).fill(false);
      let userAnswers = Array(questions.length).fill(null);
      let correctCount = 0;
      let time = 0;
      let timer = null;

      function startTimer() {
        timer = setInterval(() => {
          time++;

          const hours = Math.floor(time / 3600);
          const minutes = Math.floor((time % 3600) / 60);
          const seconds = time % 60;

          const formattedTime =
            String(hours).padStart(2, "0") +
            ":" +
            String(minutes).padStart(2, "0") +
            ":" +
            String(seconds).padStart(2, "0");

          document.getElementById(
            "timer"
          ).innerText = `‚è± Th·ªùi gian: ${formattedTime}`;
        }, 1000);
      }

      function render() {
        const q = questions[index];

        document.getElementById("q-number").innerText = `C√¢u ${index + 1} / ${
          questions.length
        }`;
        document.getElementById("question").innerText = q.question;

        const optDiv = document.getElementById("options");
        optDiv.innerHTML = "";

        for (let k in q.options) {
          const disabled = answered[index] ? "disabled" : "";
          const checked = userAnswers[index] === k ? "checked" : "";

          optDiv.innerHTML += `
                  <label class="option">
                      <input type="radio" name="opt" value="${k}" ${checked} ${disabled}>
                      ${k}. ${q.options[k]}
                  </label>`;
        }

        document.getElementById("answer").classList.add("hidden");
        document.getElementById(
          "score"
        ).innerText = `ƒê√∫ng: ${correctCount} / ${questions.length}`;
      }

      function checkAnswer() {
        if (answered[index]) return;

        const q = questions[index];
        const radios = document.querySelectorAll('input[name="opt"]');
        let selected = null;

        radios.forEach((r) => {
          if (r.checked) selected = r.value;
        });

        if (!selected) return alert("B·∫°n ch∆∞a ch·ªçn ƒë√°p √°n!");

        answered[index] = true;
        userAnswers[index] = selected;

        if (selected === q.correct) correctCount++;

        document
          .querySelectorAll(".option")
          .forEach((o) => o.classList.remove("correct", "wrong"));

        radios.forEach((r) => {
          const label = r.parentElement;

          if (r.value === q.correct) label.classList.add("correct");
          if (r.checked && r.value !== q.correct) label.classList.add("wrong");

          r.disabled = true;
        });

        document.getElementById(
          "answer"
        ).innerHTML = `ƒê√°p √°n ƒë√∫ng: <b>${q.correct}</b>`;
        document.getElementById("answer").classList.remove("hidden");

        document.getElementById(
          "score"
        ).innerText = `ƒê√∫ng: ${correctCount} / ${questions.length}`;

        if (answered.every((a) => a)) finishQuiz();
      }

      function nextQuestion() {
        if (index < questions.length - 1) {
          index++;
          render();
        }
      }

      function prevQuestion() {
        if (index > 0) {
          index--;
          render();
        }
      }

      function finishQuiz() {
        clearInterval(timer);
        alert(
          `üéâ Ho√†n th√†nh!\n` +
            `‚úî ƒê√∫ng: ${correctCount}/${questions.length}\n` +
            `‚è± Th·ªùi gian: ${time}s`
        );
      }

      function goHome() {
        if (confirm("Quay v·ªÅ trang ch·ªß? Ti·∫øn tr√¨nh s·∫Ω m·∫•t.")) {
          clearInterval(timer);
          window.location.href = "index.html";
        }
      }

      startTimer();
      render();
    </script>
  </body>
</html>
